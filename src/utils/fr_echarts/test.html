<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
  //   var testdata = {
  //   nodename: ['用户反馈', '解释', '辱骂问题', '这笔', '合成', '充钱', '女神'],
  //   size: [2121, 16, 38, 2, 4, 6, 8],
  //   cat: ['', '解释', '辱骂问题', '解释', '解释', '辱骂问题', '辱骂问题'],
  //   links: ['解释,辱骂问题', '这笔,合成', '充钱,女神', '', '', '', '']
  // }
  // var testdata = {"nodename":["用户反馈","解释","奖励领取问题","辱骂问题","合成","无法充值","闪退","礼物","第一","充值不到账","儿子","充值","更新","投诉","卡顿","游戏不好玩","金蘑菇","人机问题","声音","圣衣","请问","巨行星","名字","照片","氪金","拉菲","外挂","挂机","宝箱","充钱","喜欢","魔法","核实","正当行为","充钱","未到账","糖果","这是","第一","申诉","金蘑菇","封号","封号","蘑菇","开麦","封号","会员","双冠模式","注册","我冲","观看","生存","解释","10","队友","粉丝","卡死","炫光","到账","圣衣","大爷","挂机","高级","封号","流量","礼包","合成","匹配","一把","会员","退后","匹配","派对","两次","一会儿","订阅","充值","小龙女","拉菲","代挂","代挂","ID","恶意","十个","诚信","段位","活动","外挂","会员","原因","造型","氪金","颜色","密码","草拟","皮肤","王者","充值","发生","体验","不给","登录","你好","多钱","火箭","账号","老玩家","腊鸡","成功","匹配","一模一样","播报","爷爷","集齐","封号","留言","聋女","更卡","解释","作弊","违规","求求","充值","惩罚","你好","行为恶劣","刚刚","我家","超神","我要","自动","球球号","自己","充值","称号","我操","这笔","模式","火箭","有钱","马特","不给","听不见","拼图","联系","账号","合成","充值","加星","说话","自动","皮肤","都行","游客","脚本","双冠","有人","失败","团战","队友","款项","体验","关键词","说法","天梯","皮肤","拉菲","碎片","照片","客服","女神","网络","美好","大神","一群","登陆","队友","手机号","扣费","退钱","退后","怎么玩","双冠","拜托","合作","金蘑菇","款项","我开","下架","语音","好友","声音","充钱","孩子","自动","积分","脚本","严肃处理","记录","6元","慧根之影","原因","礼物","四年","审核","快手","金蘑菇","合成","星云航线","增重","代挂","此号","卡白房","回来","充钱","小龙女","什么意思","团队","不给","支付","救命钱","刚刚","手机号","播报","匹配","充值","账号","23","头像","自选","碎片","还给","千多","多久","ID","儿子"],"size":[2121,16,11,38,39,13,5,36,21,98,4,98,8,19,273,6,71,29,47,14,11,9,21,26,9,14,17,51,20,52,14,8,7,11,38,33,8,13,20,11,76,21,29,71,4,9,36,6,6,8,4,32,16,35,9,9,8,4,98,14,2,6,5,29,9,20,14,19,12,20,1,9,47,14,3,12,5,8,15,9,13,24,16,7,2,17,16,11,36,8,1,3,4,21,2,35,7,21,2,17,20,17,14,5,5,47,22,7,13,29,2,6,4,4,11,6,1,3,16,5,15,4,13,5,23,2,12,3,13,19,5,11,26,71,8,7,2,34,5,7,14,9,14,14,5,56,16,4,9,21,5,35,1,4,4,43,6,12,9,19,1,29,5,5,13,14,11,32,27,9,3,37,1,2,9,8,82,49,6,5,1,21,43,4,19,36,1,7,6,16,19,53,4,5,5,13,4,2,18,7,2,8,37,5,18,6,76,42,10,3,13,3,6,21,29,8,26,6,26,13,2,12,21,10,51,16,56,5,14,6,20,5,4,7,24,4],"cat":["用户反馈","解释","奖励领取问题","辱骂问题","合成","无法充值","闪退","礼物","第一","充值不到账","儿子","充值","更新","投诉","卡顿","游戏不好玩","金蘑菇","人机问题","声音","圣衣","请问","巨行星","名字","照片","氪金","拉菲","外挂","挂机","宝箱","卡顿","拉菲","宝箱","奖励领取问题","请问","辱骂问题","充值","解释","无法充值","宝箱","请问","充值不到账","名字","辱骂问题","金蘑菇","辱骂问题","氪金","金蘑菇","外挂","名字","充值不到账","声音","卡顿","充值不到账","合成","巨行星","投诉","更新","辱骂问题","充值不到账","合成","匹配","游戏不好玩","充值不到账","人机问题","卡顿","充值不到账","圣衣","投诉","挂机","宝箱","金蘑菇","巨行星","声音","第一","更新","充值","闪退","拉菲","辱骂问题","氪金","人机问题","辱骂问题","辱骂问题","宝箱","礼物","外挂","解释","奖励领取问题","充值","奖励领取问题","礼物","人机问题","名字","名字","人机问题","合成","匹配","第一","第一","外挂","宝箱","第一","圣衣","氪金","圣衣","声音","卡顿","匹配","无法充值","人机问题","氪金","游戏不好玩","儿子","合成","奖励领取问题","游戏不好玩","拉菲","更新","金蘑菇","投诉","照片","儿子","无法充值","辱骂问题","照片","奖励领取问题","充值不到账","卡顿","挂机","投诉","外挂","奖励领取问题","照片","金蘑菇","更新","人机问题","解释","辱骂问题","奖励领取问题","拉菲","礼物","氪金","声音","圣衣","充值","金蘑菇","解释","儿子","第一","声音","奖励领取问题","金蘑菇","金蘑菇","人机问题","奖励领取问题","挂机","游戏不好玩","合成","巨行星","投诉","解释","人机问题","合成","第一","挂机","拉菲","请问","合成","手机号","氪金","辱骂问题","卡顿","照片","更新","匹配","外挂","匹配","卡顿","充值","投诉","闪退","匹配","卡顿","游戏不好玩","投诉","礼物","充值不到账","声音","照片","声音","卡顿","卡顿","儿子","充值","巨行星","礼物","外挂","外挂","第一","充值不到账","合成","外挂","金蘑菇","解释","照片","外挂","充值","充值","宝箱","宝箱","外挂","第一","人机问题","第一","人机问题","请问","挂机","游戏不好玩","照片","金蘑菇","儿子","宝箱","名字","名字","挂机","解释","充值","挂机","拉菲","宝箱","宝箱","投诉","解释","请问","礼物","充值"],"links":["合成,挂机,礼物,游戏不好玩,拉菲,充值不到账,投诉,请问,氪金,人机问题,第一,无法充值,奖励领取问题,更新,声音,解释,充值,儿子,金蘑菇,照片,辱骂问题,外挂,宝箱,圣衣,闪退,名字,巨行星,卡顿","这笔,合成,款项,糖果,千多,充值,四年,活动","球球号,外挂,行为恶劣,原因,核实,脚本,自动,封号,火箭","充钱,女神,开麦,惩罚,拉菲,封号,炫光,ID,模式,恶意","10,慧根之影,集齐,失败,圣衣,皮肤,关键词,碎片","这是,成功,充值","充值,退后","金蘑菇,造型,积分,诚信,马特,ID","回来,两次,发生,登录,说法,充值,加星,记录,此号","款项,金蘑菇,高级,解释,刚刚,6元,我冲,到账,礼包","爷爷,充钱,求求,充值,救命钱","合成,孩子,金蘑菇,未到账,联系,订阅,会员,儿子,账号,扣费","大神,称号,更卡,卡死,一会儿","匹配,退钱,作弊,队友,合作,粉丝,还给,我要","充钱,生存,手机号,网络,我家,好友,老玩家,双冠,声音,流量","挂机,播报,有人,拜托,留言,团队","支付,礼物,蘑菇,都行,解释,充值,会员,皮肤,退后,账号","匹配,草拟,充钱,游客,代挂,我操,封号,氪金,卡白房,体验","我开,说话,观看,听不见,派对,账号,语音","合成,你好,拼图,火箭","小龙女,正当行为,多久,拉菲,申诉","匹配,队友,团战,自动","手机号,播报,注册,颜色,封号,密码","违规,美好,审核,自己,你好,下架,不给","一模一样,代挂,封号,多钱,客服,不给","小龙女,头像,有钱,皮肤,聋女,喜欢","严肃处理,快手,原因,脚本,代挂,自动,双冠模式,段位,体验,登陆","天梯,匹配,23,一把,什么意思,双冠,超神","第一,星云航线,增重,刚刚,自选,魔法,会员,十个,不给,碎片","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]}
  var testdata =  {"nodename":["用户反馈","解释","奖励领取问题","辱骂问题","合成","无法充值","闪退","礼物","第一","充值不到账","儿子","充值","更新","投诉","卡顿","游戏不好玩","金蘑菇","人机问题","声音","圣衣","请问","巨行星","名字","照片","氪金","拉菲","外挂","挂机","宝箱","充钱","喜欢","魔法","核实","正当行为","充钱","未到账","糖果","这是","第一","申诉","金蘑菇","封号","封号","蘑菇","开麦","封号","会员","双冠模式","注册","我冲","观看","生存","解释","10","队友","粉丝","卡死","炫光","到账","圣衣","大爷","挂机","高级","封号","流量","礼包","合成","匹配","一把","会员","退后","匹配","派对","两次","一会儿","订阅","充值","小龙女","拉菲","代挂","代挂","ID","恶意","十个","诚信","段位","活动","外挂","会员","原因","造型","氪金","颜色","密码","草拟","皮肤","王者","充值","发生","体验","不给","登录","你好","多钱","火箭","账号","老玩家","腊鸡","成功","匹配","一模一样","播报","爷爷","集齐","封号","留言","聋女","更卡","解释","作弊","违规","求求","充值","惩罚","你好","行为恶劣","刚刚","我家","超神","我要","自动","球球号","自己","充值","称号","我操","这笔","模式","火箭","有钱","马特","不给","听不见","拼图","联系","账号","合成","充值","加星","说话","自动","皮肤","都行","游客","脚本","双冠","有人","失败","团战","队友","款项","体验","关键词","说法","天梯","皮肤","拉菲","碎片","照片","客服","女神","网络","美好","大神","一群","登陆","队友","手机号","扣费","退钱","退后","怎么玩","双冠","拜托","合作","金蘑菇","款项","我开","下架","语音","好友","声音","充钱","孩子","自动","积分","脚本","严肃处理","记录","6元","慧根之影","原因","礼物","四年","审核","快手","金蘑菇","合成","星云航线","增重","代挂","此号","卡白房","回来","充钱","小龙女","什么意思","团队","不给","支付","救命钱","刚刚","手机号","播报","匹配","充值","账号","23","头像","自选","碎片","还给","千多","多久","ID","儿子"],"size":[2121,16,11,38,39,13,5,36,21,98,4,98,8,19,273,6,71,29,47,14,11,9,21,26,9,14,17,51,20,52,14,8,7,11,38,33,8,13,20,11,76,21,29,71,4,9,36,6,6,8,4,32,16,35,9,9,8,4,98,14,2,6,5,29,9,20,14,19,12,20,1,9,47,14,3,12,5,8,15,9,13,24,16,7,2,17,16,11,36,8,1,3,4,21,2,35,7,21,2,17,20,17,14,5,5,47,22,7,13,29,2,6,4,4,11,6,1,3,16,5,15,4,13,5,23,2,12,3,13,19,5,11,26,71,8,7,2,34,5,7,14,9,14,14,5,56,16,4,9,21,5,35,1,4,4,43,6,12,9,19,1,29,5,5,13,14,11,32,27,9,3,37,1,2,9,8,82,49,6,5,1,21,43,4,19,36,1,7,6,16,19,53,4,5,5,13,4,2,18,7,2,8,37,5,18,6,76,42,10,3,13,3,6,21,29,8,26,6,26,13,2,12,21,10,51,16,56,5,14,6,20,5,4,7,24,4],"cat":["","解释","奖励领取问题","辱骂问题","合成","无法充值","闪退","礼物","第一","充值不到账","儿子","充值","更新","投诉","卡顿","游戏不好玩","金蘑菇","人机问题","声音","圣衣","请问","巨行星","名字","照片","氪金","拉菲","外挂","挂机","宝箱","卡顿","拉菲","宝箱","奖励领取问题","请问","辱骂问题","充值","解释","无法充值","宝箱","请问","充值不到账","名字","辱骂问题","金蘑菇","辱骂问题","氪金","金蘑菇","外挂","名字","充值不到账","声音","卡顿","充值不到账","合成","巨行星","投诉","更新","辱骂问题","充值不到账","合成","匹配","游戏不好玩","充值不到账","人机问题","卡顿","充值不到账","圣衣","投诉","挂机","宝箱","金蘑菇","巨行星","声音","第一","更新","充值","闪退","拉菲","辱骂问题","氪金","人机问题","辱骂问题","辱骂问题","宝箱","礼物","外挂","解释","奖励领取问题","充值","奖励领取问题","礼物","人机问题","名字","名字","人机问题","合成","匹配","第一","第一","外挂","宝箱","第一","圣衣","氪金","圣衣","声音","卡顿","匹配","无法充值","人机问题","氪金","游戏不好玩","儿子","合成","奖励领取问题","游戏不好玩","拉菲","更新","金蘑菇","投诉","照片","儿子","无法充值","辱骂问题","照片","奖励领取问题","充值不到账","卡顿","挂机","投诉","外挂","奖励领取问题","照片","金蘑菇","更新","人机问题","解释","辱骂问题","奖励领取问题","拉菲","礼物","氪金","声音","圣衣","充值","金蘑菇","解释","儿子","第一","声音","奖励领取问题","金蘑菇","金蘑菇","人机问题","奖励领取问题","挂机","游戏不好玩","合成","巨行星","投诉","解释","人机问题","合成","第一","挂机","拉菲","请问","合成","手机号","氪金","辱骂问题","卡顿","照片","更新","匹配","外挂","匹配","卡顿","充值","投诉","闪退","匹配","卡顿","游戏不好玩","投诉","礼物","充值不到账","声音","照片","声音","卡顿","卡顿","儿子","充值","巨行星","礼物","外挂","外挂","第一","充值不到账","合成","外挂","金蘑菇","解释","照片","外挂","充值","充值","宝箱","宝箱","外挂","第一","人机问题","第一","人机问题","请问","挂机","游戏不好玩","照片","金蘑菇","儿子","宝箱","名字","名字","挂机","解释","充值","挂机","拉菲","宝箱","宝箱","投诉","解释","请问","礼物","充值"],"links":["合成,挂机,礼物,游戏不好玩,拉菲,充值不到账,投诉,请问,氪金,人机问题,第一,无法充值,奖励领取问题,更新,声音,解释,充值,儿子,金蘑菇,照片,辱骂问题,外挂,宝箱,圣衣,闪退,名字,巨行星,卡顿","这笔,合成,款项,糖果,千多,充值,四年,活动","球球号,外挂,行为恶劣,原因,核实,脚本,自动,封号,火箭","充钱,女神,开麦,惩罚,拉菲,封号,炫光,ID,模式,恶意","10,慧根之影,集齐,失败,圣衣,皮肤,关键词,碎片","这是,成功,充值","充值,退后","金蘑菇,造型,积分,诚信,马特,ID","回来,两次,发生,登录,说法,充值,加星,记录,此号","款项,金蘑菇,高级,解释,刚刚,6元,我冲,到账,礼包","爷爷,充钱,求求,充值,救命钱","合成,孩子,金蘑菇,未到账,联系,订阅,会员,儿子,账号,扣费","大神,称号,更卡,卡死,一会儿","匹配,退钱,作弊,队友,合作,粉丝,还给,我要","充钱,生存,手机号,网络,我家,好友,老玩家,双冠,声音,流量","挂机,播报,有人,拜托,留言,团队","支付,礼物,蘑菇,都行,解释,充值,会员,皮肤,退后,账号","匹配,草拟,充钱,游客,代挂,我操,封号,氪金,卡白房,体验","我开,说话,观看,听不见,派对,账号,语音","合成,你好,拼图,火箭","小龙女,正当行为,多久,拉菲,申诉","匹配,队友,团战,自动","手机号,播报,注册,颜色,封号,密码","违规,美好,审核,自己,你好,下架,不给","一模一样,代挂,封号,多钱,客服,不给","小龙女,头像,有钱,皮肤,聋女,喜欢","严肃处理,快手,原因,脚本,代挂,自动,双冠模式,段位,体验,登陆","天梯,匹配,23,一把,什么意思,双冠,超神","第一,星云航线,增重,刚刚,自选,魔法,会员,十个,不给,碎片","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]}
  // 将服务器数据解析为echarts需要的格式
  var group = function (data, def) {
    var nodes = [];
    var links = [];
    var cat_dict = {}
    var categories = [];
    var len = data[def.nodename].length;

    for (cat_k in data[def.cat]) {
      if (!cat_dict[data[def.cat][cat_k]]) {
        data[def.cat][cat_k] ? cat_dict[data[def.cat][cat_k]] = cat_k : cat_dict['___##@@'] = cat_k;       // {"卡顿":1, "xxx":2}
        data[def.cat][cat_k] ? categories[cat_k] = {name: data[def.cat][cat_k]} : categories[cat_k] = {name: data[def.nodename][cat_k]};
      }
    }
    console.log(categories);

    for (var i = 0; i < len; i++) {
      var nodename = data[def.nodename][i];
      var size = data[def.size][i];
      var cat = data[def.cat][i];
      nodes.push({
        "id": i,
        "name": nodename,
        "itemStyle": null,
        "symbolSize": size,
        "value": 0,
        "attributes": {
          "modularity_class": cat_dict[cat] ? cat_dict[cat] : cat_dict['___##@@'],
        },
        "label": {
          "show": true
        },
        "cat": cat,
        "category": cat_dict[cat] ? cat_dict[cat] : cat_dict['___##@@']
      })
    }
    console.log(nodes);

    for (let index = 0; index < len; index++) {
      var nodelinks = data[def.links][index];
      var cat = data[def.cat][index];
      var nodename = data[def.nodename][index];
      if (nodelinks && nodelinks.length > 0) {
        var temps = nodelinks.split(',');
        for (let j = 0; j < temps.length; j++) {
          const element = temps[j];
          console.log(cat)
          let node = nodes.find((n) => {
            if (cat && cat.length > 0) {
              return n.name == element && n.cat == cat;
            } else {
              return n.name == element;
            }
          })
          console.log(node);
          links.push({
            "id": index + '_' + j,
            "name": null,
            "source": index,
            "target": node.id,
            "lineStyle": { "normal": {} }
          })
        }
      }
    }
    return {
      nodes: nodes,
      links: links,
      categories: categories
    };
  };

  var ret = group(testdata, {nodename:'nodename', size:'size', cat: 'cat', links: 'links'});
  console.log(ret)

  </script>
</body>
</html>